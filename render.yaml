services:
  # Worker Service - Celery with Playwright (Docker)
  - type: worker
    name: reportscompany-worker
    runtime: docker
    dockerfilePath: ./apps/worker/Dockerfile
    dockerContext: ./apps/worker
    region: oregon
    plan: starter
    branch: main
    repo: https://github.com/easydeed/reportscompany
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: mr-staging-db
          property: connectionString
      - key: REDIS_URL
        sync: false
      - key: SIMPLYRETS_USERNAME
        sync: false
      - key: SIMPLYRETS_PASSWORD
        sync: false
      - key: R2_ACCOUNT_ID
        sync: false
      - key: R2_ACCESS_KEY_ID
        sync: false
      - key: R2_SECRET_ACCESS_KEY
        sync: false
      - key: R2_BUCKET_NAME
        sync: false
      - key: PRINT_BASE
        sync: false

  # Consumer Service - Redis Bridge (Docker)
  - type: worker
    name: reportscompany-consumer
    runtime: docker
    dockerfilePath: ./apps/worker/Dockerfile
    dockerContext: ./apps/worker
    dockerCommand: poetry run python -c "from worker.tasks import run_redis_consumer_forever as c; c()"
    region: oregon
    plan: starter
    branch: main
    repo: https://github.com/easydeed/reportscompany
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: mr-staging-db
          property: connectionString
      - key: REDIS_URL
        sync: false
      - key: SIMPLYRETS_USERNAME
        sync: false
      - key: SIMPLYRETS_PASSWORD
        sync: false
      - key: R2_ACCOUNT_ID
        sync: false
      - key: R2_ACCESS_KEY_ID
        sync: false
      - key: R2_SECRET_ACCESS_KEY
        sync: false
      - key: R2_BUCKET_NAME
        sync: false
      - key: PRINT_BASE
        sync: false

