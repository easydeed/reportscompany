{# =============================================================================
   ELEGANT THEME
   Sophisticated, refined, boutique luxury aesthetic
   
   Typography: Cormorant Garamond (display) + Montserrat (body)
   Colors: Deep charcoal + champagne gold
   Style: Delicate flourishes, refined typography, understated luxury
   ============================================================================= #}

{% extends '_base/base.jinja2' %}

{% block fonts %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
{% endblock %}

{% block theme_styles %}
  :root {
    /* Elegant Theme Colors - Primary is customizable */
    --color-primary: {{ theme_color | default('#1A1A1A', true) }};
    --color-primary-light: #333333;
    --color-accent: #B8977E;
    --color-accent-light: #D4C4B0;
    --color-background: #FFFFFF;
    --color-surface: #FAF8F5;
    --color-text: #1A1A1A;
    --color-text-muted: #6B6B6B;
    --color-border: #E8E4DE;
    
    /* Typography */
    --font-display: 'Cormorant Garamond', Georgia, serif;
    --font-body: 'Montserrat', system-ui, sans-serif;
    
    /* Elegant-specific */
    --radius-sm: 0;
    --radius-md: 0;
    --radius-lg: 0;
    
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
    --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.08);
  }
  
  /* ==========================================================================
     ELEGANT: Cover Page
     ========================================================================== */
  
  .page-cover {
    background: var(--color-primary);
  }
  
  .page-cover .cover-bg {
    position: absolute;
    inset: 0;
    background: 
      linear-gradient(180deg, 
        rgba(26, 26, 26, 0.0) 0%,
        rgba(26, 26, 26, 0.1) 40%,
        rgba(26, 26, 26, 0.88) 100%
      ){% if images.hero %},
      url('{{ images.hero }}') center/cover no-repeat{% endif %};
  }
  
  /* Top accent line */
  .page-cover::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--color-accent);
    z-index: 10;
  }
  
  /* Corner flourishes */
  .page-cover .flourish-tl,
  .page-cover .flourish-br {
    position: absolute;
    width: 60px;
    height: 60px;
    z-index: 5;
  }
  
  .page-cover .flourish-tl {
    top: 20px;
    left: 20px;
    border-top: 1px solid var(--color-accent);
    border-left: 1px solid var(--color-accent);
    opacity: 0.6;
  }
  
  .page-cover .flourish-br {
    bottom: 130px;
    right: 20px;
    border-bottom: 1px solid var(--color-accent);
    border-right: 1px solid var(--color-accent);
    opacity: 0.6;
  }
  
  /* Branding header */
  .page-cover .cover-branding-header {
    position: absolute;
    top: calc(var(--page-margin) + 20px);
    left: var(--page-margin);
    right: var(--page-margin);
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 5;
  }
  
  .page-cover .report-badge {
    font-family: var(--font-body);
    font-size: 10px;
    font-weight: 500;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: rgba(255,255,255,0.7);
    border: 1px solid rgba(255,255,255,0.3);
    padding: 8px 16px;
  }
  
  /* Main content area */
  .page-cover .cover-content {
    position: absolute;
    bottom: 150px;
    left: var(--page-margin);
    right: var(--page-margin);
    z-index: 5;
  }
  
  .page-cover .cover-property-type {
    font-family: var(--font-body);
    font-size: 11px;
    font-weight: 400;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: var(--color-accent);
    margin-bottom: 20px;
  }
  
  .page-cover .cover-address {
    font-family: var(--font-display);
    font-size: 56px;
    font-weight: 400;
    font-style: italic;
    line-height: 1.1;
    color: white;
    margin-bottom: 16px;
    text-shadow: 0 2px 16px rgba(0,0,0,0.25);
  }
  
  .page-cover .cover-location {
    font-family: var(--font-body);
    font-size: 14px;
    font-weight: 400;
    letter-spacing: 2px;
    color: rgba(255,255,255,0.8);
  }
  
  .page-cover .cover-accent-line {
    width: 40px;
    height: 1px;
    background: var(--color-accent);
    margin: 30px 0;
  }
  
  .page-cover .property-stats {
    margin-top: 20px;
    gap: var(--space-2xl);
  }
  
  .page-cover .stat-value {
    color: white;
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: 500;
  }
  
  .page-cover .stat-label {
    color: rgba(255,255,255,0.6);
    font-weight: 400;
    letter-spacing: 2px;
  }
  
  /* Footer override for cover */
  .page-cover .cover-footer {
    height: 120px;
    padding: 0 var(--page-margin);
    background: white;
  }
  
  .page-cover .cover-agent-photo {
    border: 2px solid var(--color-accent);
    width: 70px;
    height: 70px;
  }
  
  .page-cover .cover-agent-name {
    font-family: var(--font-display);
    font-size: 22px;
    font-weight: 500;
    font-style: italic;
  }
  
  .page-cover .cover-agent-title {
    font-weight: 400;
    letter-spacing: 1px;
  }
  
  /* ==========================================================================
     ELEGANT: Page Header Overrides
     ========================================================================== */
  
  .page-header {
    border-bottom: none;
    padding-bottom: var(--space-lg);
    position: relative;
  }
  
  .page-header::after {
    content: '';
    display: block;
    width: 40px;
    height: 1px;
    background: var(--color-accent);
    margin-top: var(--space-md);
  }
  
  .page-title {
    font-size: 38px;
    font-weight: 400;
    font-style: italic;
    letter-spacing: 0;
  }
  
  .page-subtitle {
    font-weight: 400;
    letter-spacing: 1px;
  }
  
  .page-header-accent {
    display: none;
  }
  
  /* ==========================================================================
     ELEGANT: Contents Page
     ========================================================================== */
  
  .page-contents .contents-item {
    border-bottom: 1px solid var(--color-border);
    padding: var(--space-lg) 0;
  }
  
  .page-contents .contents-number {
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: 400;
    color: var(--color-accent);
    min-width: 60px;
  }
  
  .page-contents .contents-title {
    font-family: var(--font-display);
    font-size: 22px;
    font-weight: 500;
    font-style: italic;
  }
  
  .page-contents .contents-subtitle {
    font-weight: 400;
    letter-spacing: 1px;
  }
  
  /* ==========================================================================
     ELEGANT: Data Tables
     ========================================================================== */
  
  .data-table tr:nth-child(even) {
    background: var(--color-surface);
  }
  
  .data-table td {
    padding: 14px 0;
    border-bottom: 1px solid var(--color-border);
  }
  
  .data-label {
    font-weight: 400;
    letter-spacing: 0.5px;
  }
  
  .data-value {
    font-weight: 500;
  }
  
  .table-title {
    font-family: var(--font-display);
    font-style: italic;
    font-weight: 500;
    letter-spacing: 0;
    text-transform: none;
    font-size: 18px;
    color: var(--color-primary);
    padding-bottom: var(--space-sm);
    border-bottom: 1px solid var(--color-accent);
    margin-bottom: var(--space-md);
  }
  
  /* ==========================================================================
     ELEGANT: Comp Cards
     ========================================================================== */
  
  .comp-card {
    border: 1px solid var(--color-border);
  }
  
  .comp-card-header {
    background: var(--color-primary);
    padding: 12px var(--space-md);
  }
  
  .comp-number {
    font-family: var(--font-display);
    font-style: italic;
  }
  
  .comp-price {
    font-family: var(--font-display);
    font-size: 18px;
    font-weight: 500;
  }
  
  .comp-address {
    font-family: var(--font-display);
    font-style: italic;
    font-weight: 500;
  }
  
  .comp-details {
    background: var(--color-surface);
  }
  
  .comp-image {
    height: 170px;
  }
  
  /* ==========================================================================
     ELEGANT: Analysis Summary
     ========================================================================== */
  
  .analysis-summary {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
  }
  
  .range-value {
    font-family: var(--font-display);
    font-weight: 500;
  }
  
  .range-label {
    letter-spacing: 2px;
  }
  
  .range-median .range-value {
    color: var(--color-accent);
    font-size: 26px;
  }
  
  .analysis-stat-value {
    font-family: var(--font-display);
    font-weight: 500;
  }
  
  .analysis-stat-label {
    letter-spacing: 1px;
  }
  
  /* ==========================================================================
     ELEGANT: Map Card
     ========================================================================== */
  
  .map-card {
    border: 1px solid var(--color-border);
  }
  
  .map-card-header {
    background: var(--color-surface);
    font-family: var(--font-display);
    font-style: italic;
    font-weight: 500;
    letter-spacing: 0;
    text-transform: none;
    font-size: 18px;
  }
  
  .map-card-image {
    height: 440px;
  }
  
  /* ==========================================================================
     ELEGANT: Price Range
     ========================================================================== */
  
  .price-range-track {
    height: 6px;
    background: linear-gradient(90deg, 
      var(--color-surface) 0%, 
      var(--color-accent) 50%,
      var(--color-surface) 100%
    );
    border-radius: 0;
  }
  
  .price-range-marker-label {
    background: var(--color-primary);
    font-family: var(--font-display);
    font-size: 14px;
    font-weight: 500;
    padding: 6px 14px;
    border-radius: 0;
  }
  
  /* Range comps list */
  .range-comps-list {
    margin-top: var(--space-xl);
    border: 1px solid var(--color-border);
  }
  
  .range-comp-item {
    display: flex;
    justify-content: space-between;
    padding: var(--space-md) var(--space-lg);
    border-bottom: 1px solid var(--color-border);
  }
  
  .range-comp-item:last-child {
    border-bottom: none;
  }
  
  .range-comp-item:nth-child(even) {
    background: var(--color-surface);
  }
  
  .range-comp-address {
    font-family: var(--font-display);
    font-size: 16px;
    font-weight: 500;
    font-style: italic;
  }
  
  .range-comp-price {
    font-family: var(--font-display);
    font-size: 18px;
    font-weight: 500;
    color: var(--color-primary);
  }
  
  /* ==========================================================================
     ELEGANT: Footer Overrides
     ========================================================================== */
  
  .footer-agent-name {
    font-family: var(--font-display);
    font-style: italic;
    font-weight: 500;
    font-size: 13px;
  }
  
  .footer-agent-photo {
    border-color: var(--color-accent);
  }
  
  /* V0 overrides — Elegant */
  .section-title {
    font-style: italic;
    font-weight: 500;
    letter-spacing: 0;
  }
  
  .comparison-table {
    border: none;
  }
  
  .comparison-header {
    background: transparent;
    color: var(--color-primary);
    border-bottom: 2px solid var(--color-accent);
  }
  
  .comparison-row {
    padding: 7px 0;
    border-bottom: 1px solid var(--color-border);
  }
  
  .comparison-row-stripe {
    background: transparent;
  }
  
  .aerial-info-value {
    font-style: italic;
  }
  
  .key-stat-value {
    font-style: italic;
  }
  
  .range-stat-value {
    font-style: italic;
  }
  
  .market-insight {
    background: transparent;
    border-left: 3px solid var(--color-accent);
  }
  
  .market-insight-title {
    font-style: italic;
  }
  
  .contents-sidebar-accent {
    display: none;
  }

  /* ==========================================================================
     ELEGANT: Internal Page Accents — Theme personality on pages 2-7
     ========================================================================== */

  /* Delicate top accent line on internal pages */
  .page-contents::before,
  .page-aerial::before,
  .page-property::before,
  .page-analysis::before,
  .page-comparables::before,
  .page-range::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--color-accent);
    z-index: 10;
  }

  /* Key stats bar — elegant dark */
  .key-stats-bar {
    background: var(--color-primary);
  }

  /* Analysis summary — subtle accent */
  .analysis-summary {
    border-top: 1px solid var(--color-accent);
  }

  /* Range bar container */
  .range-bar-container {
    border-top: 1px solid var(--color-accent);
  }

  /* Stats grid cards */
  .range-stat-card {
    border-top: 1px solid var(--color-accent);
  }

  /* Contents page — decorative accent line */
  .page-contents .contents-list::before {
    content: '';
    display: block;
    width: 40px;
    height: 1px;
    background: var(--color-accent);
    margin-bottom: var(--space-lg);
  }

  /* ==========================================================================
     ELEGANT V0 ORIGINAL: Corner Flourishes — Transplanted from commit 8dbec7b
     ========================================================================== */

  .elegant-v0-p5 .corner-flourish,
  .elegant-v0-p6 .corner-flourish,
  .elegant-v0-p7 .corner-flourish { position: absolute; width: 120px; height: 120px; opacity: 0.12; }
  .elegant-v0-p5 .corner-flourish-line-h,
  .elegant-v0-p6 .corner-flourish-line-h,
  .elegant-v0-p7 .corner-flourish-line-h { position: absolute; background: var(--color-accent); width: 60px; height: 2px; }
  .elegant-v0-p5 .corner-flourish-line-v,
  .elegant-v0-p6 .corner-flourish-line-v,
  .elegant-v0-p7 .corner-flourish-line-v { position: absolute; background: var(--color-accent); width: 2px; height: 60px; }
  .elegant-v0-p5 .corner-flourish.tl,
  .elegant-v0-p6 .corner-flourish.tl,
  .elegant-v0-p7 .corner-flourish.tl { top: 20px; left: 20px; }
  .elegant-v0-p5 .corner-flourish.tl .corner-flourish-line-h,
  .elegant-v0-p6 .corner-flourish.tl .corner-flourish-line-h,
  .elegant-v0-p7 .corner-flourish.tl .corner-flourish-line-h { top: 0; left: 0; }
  .elegant-v0-p5 .corner-flourish.tl .corner-flourish-line-v,
  .elegant-v0-p6 .corner-flourish.tl .corner-flourish-line-v,
  .elegant-v0-p7 .corner-flourish.tl .corner-flourish-line-v { top: 0; left: 0; }
  .elegant-v0-p5 .corner-flourish.br,
  .elegant-v0-p6 .corner-flourish.br,
  .elegant-v0-p7 .corner-flourish.br { bottom: 20px; right: 20px; }
  .elegant-v0-p5 .corner-flourish.br .corner-flourish-line-h,
  .elegant-v0-p6 .corner-flourish.br .corner-flourish-line-h,
  .elegant-v0-p7 .corner-flourish.br .corner-flourish-line-h { bottom: 0; right: 0; }
  .elegant-v0-p5 .corner-flourish.br .corner-flourish-line-v,
  .elegant-v0-p6 .corner-flourish.br .corner-flourish-line-v,
  .elegant-v0-p7 .corner-flourish.br .corner-flourish-line-v { bottom: 0; right: 0; }

  /* Shared header and accents for V0 pages */
  .elegant-v0-p5 .property-header,
  .elegant-v0-p6 .property-header,
  .elegant-v0-p7 .property-header { text-align: center; margin-bottom: 0.35in; }
  .elegant-v0-p5 .property-label,
  .elegant-v0-p6 .property-label,
  .elegant-v0-p7 .property-label { font-size: 10px; letter-spacing: 0.28em; text-transform: uppercase; color: var(--color-text-muted); margin-bottom: 10px; font-weight: 400; }
  .elegant-v0-p5 .property-title,
  .elegant-v0-p6 .property-title,
  .elegant-v0-p7 .property-title { font-family: var(--font-display); font-size: 38px; color: var(--color-text); font-weight: 400; font-style: italic; }
  .elegant-v0-p5 .gold-rule,
  .elegant-v0-p6 .gold-rule,
  .elegant-v0-p7 .gold-rule { width: 80px; height: 3px; background: linear-gradient(90deg, transparent, var(--color-accent), transparent); margin: 15px auto; }
  .elegant-v0-p5 .diamond,
  .elegant-v0-p6 .diamond,
  .elegant-v0-p7 .diamond { width: 6px; height: 6px; background: var(--color-accent); display: inline-block; border-radius: 1px; vertical-align: middle; }

  /* ==========================================================================
     ELEGANT V0 ORIGINAL: Analysis Page (p5) — Transplanted from commit 8dbec7b
     Burgundy gradient bar chart + gold-bordered analysis table
     ========================================================================== */

  .elegant-v0-p5 .analysis-chart { background: var(--color-surface); border-radius: 8px; padding: 25px; margin-bottom: 25px; border: 1px solid var(--color-border); border-top: 2px solid var(--color-accent); }
  .elegant-v0-p5 .chart-bars { display: flex; align-items: flex-end; justify-content: space-around; height: 290px; padding: 0 20px; border-bottom: 2px solid var(--color-primary); }
  .elegant-v0-p5 .chart-bar-wrap { display: flex; flex-direction: column; align-items: center; gap: 8px; }
  .elegant-v0-p5 .chart-bar { width: 60px; background: linear-gradient(180deg, var(--color-primary-light) 0%, var(--color-primary) 100%); border-radius: 3px 3px 0 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
  .elegant-v0-p5 .chart-bar-label { font-size: 11px; color: var(--color-text-muted); letter-spacing: 0.03em; }
  .elegant-v0-p5 .analysis-table { width: 100%; border-collapse: collapse; font-size: 12px; }
  .elegant-v0-p5 .analysis-table thead { background: var(--color-primary); color: #fff; }
  .elegant-v0-p5 .analysis-table th { padding: 12px 10px; text-align: left; font-weight: 500; letter-spacing: 0.08em; text-transform: uppercase; font-size: 10px; }
  .elegant-v0-p5 .analysis-table tbody tr:nth-child(even) { background: var(--color-surface); }
  .elegant-v0-p5 .analysis-table td { padding: 10px; border-bottom: 1px solid var(--color-border); }
  .elegant-v0-p5 .analysis-table tfoot { background: var(--color-accent-light); font-weight: 600; }
  .elegant-v0-p5 .analysis-table tfoot td { padding: 12px 10px; color: var(--color-text); }

  /* ==========================================================================
     ELEGANT V0 ORIGINAL: Comparables Page (p6) — Transplanted from commit 8dbec7b
     Rounded cards with burgundy price badge, pin SVG, cream stat grid
     ========================================================================== */

  .elegant-v0-p6 .comp-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 0.3in; }
  .elegant-v0-p6 .comp-card { background: #fff; overflow: hidden; border: 1px solid var(--color-border); border-top: 2px solid var(--color-accent); box-shadow: var(--shadow-sm); }
  .elegant-v0-p6 .comp-card-image { height: 220px; background: var(--color-border); position: relative; }
  .elegant-v0-p6 .comp-card-image img { width: 100%; height: 100%; object-fit: cover; }
  .elegant-v0-p6 .comp-card-badge { position: absolute; top: 10px; right: 10px; background: var(--color-primary); color: #fff; padding: 6px 12px; font-size: 14px; font-weight: 600; font-family: var(--font-display); }
  .elegant-v0-p6 .comp-card-body { padding: 15px; }
  .elegant-v0-p6 .comp-card-address { font-family: var(--font-display); font-size: 15px; font-style: italic; color: var(--color-text); margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
  .elegant-v0-p6 .comp-card-address svg { width: 14px; height: 14px; fill: var(--color-accent); }
  .elegant-v0-p6 .comp-card-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; font-size: 11px; }
  .elegant-v0-p6 .comp-stat { text-align: center; padding: 8px 4px; background: var(--color-surface); border-top: 1px solid var(--color-border); }
  .elegant-v0-p6 .comp-stat-label { color: var(--color-text-muted); margin-bottom: 3px; letter-spacing: 0.04em; }
  .elegant-v0-p6 .comp-stat-value { color: var(--color-text); font-weight: 600; }

  /* ==========================================================================
     ELEGANT V0 ORIGINAL: Range Page (p7) — Transplanted from commit 8dbec7b
     Rounded map, dark stat cards with gold numbers, gradient slider
     ========================================================================== */

  .elegant-v0-p7 .range-map { height: 4in; background: var(--color-border); overflow: hidden; margin: 0.25in 0; border: 1px solid var(--color-border); }
  .elegant-v0-p7 .range-map img { width: 100%; height: 100%; object-fit: cover; }
  .elegant-v0-p7 .range-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0; background: var(--color-primary); padding: 28px 20px; margin-bottom: 25px; border-top: 2px solid var(--color-accent); }
  .elegant-v0-p7 .range-stat { text-align: center; color: #fff; padding: 8px 0; border-left: 1px solid rgba(255,255,255,0.08); }
  .elegant-v0-p7 .range-stat:first-child { border-left: none; }
  .elegant-v0-p7 .range-stat-num { font-family: var(--font-display); font-size: 46px; color: var(--color-accent); line-height: 1; font-style: italic; }
  .elegant-v0-p7 .range-stat-label { font-size: 10px; letter-spacing: 0.14em; text-transform: uppercase; margin-top: 10px; opacity: 0.8; font-family: var(--font-body); font-weight: 400; }
  .elegant-v0-p7 .range-slider { padding: 20px 0; }
  .elegant-v0-p7 .range-slider-labels { display: flex; justify-content: space-between; font-family: var(--font-display); font-size: 22px; color: var(--color-primary); font-style: italic; }
  .elegant-v0-p7 .range-slider-track { height: 6px; background: linear-gradient(90deg, var(--color-accent-light) 0%, var(--color-accent) 50%, var(--color-primary) 100%); position: relative; margin: 28px 0; }
  .elegant-v0-p7 .range-slider-dot { width: 18px; height: 18px; background: white; border: 2px solid var(--color-accent); border-radius: 50%; position: absolute; top: -6px; margin-left: -9px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
  .elegant-v0-p7 .range-note { font-size: 12px; line-height: 1.75; color: var(--color-text-muted); text-align: center; max-width: 90%; margin: 0 auto; font-weight: 300; letter-spacing: 0.02em; }
{% endblock %}

{# =============================================================================
   COVER PAGE OVERRIDE
   ============================================================================= #}
{% block cover %}
<div class="cover-bg"></div>
<div class="flourish-tl"></div>
<div class="flourish-br"></div>

<div class="cover-branding-header">
  <div class="report-badge">Property Report</div>
  {% if agent.logo_url %}
  <img src="{{ agent.logo_url }}" alt="{{ agent.company_name }}" style="max-height: 45px; max-width: 150px; object-fit: contain;">
  {% else %}
  <span style="font-family: var(--font-display); font-size: 18px; font-weight: 500; font-style: italic; color: rgba(255,255,255,0.8);">{{ agent.company_name }}</span>
  {% endif %}
</div>

<div class="cover-content">
  <div class="cover-property-type">{{ property.property_type | default('Single Family Residence') }}</div>
  <h1 class="cover-address">{{ property.street_address }}</h1>
  <p class="cover-location">{{ property.city }}, {{ property.state }} {{ property.zip_code }}</p>
  <div class="cover-accent-line"></div>
  {{ macros.property_stats(property) }}
</div>

{{ macros.cover_agent_block(agent) }}
{% endblock %}

{# =============================================================================
   ANALYSIS PAGE OVERRIDE — Transplanted from V0 original (commit 8dbec7b)
   Corner flourishes + burgundy gradient bar chart + gold-accented analysis table
   ============================================================================= #}
{% block analysis %}
<div class="page-content elegant-v0-p5" style="padding: 0.6in;">
  <div class="corner-flourish tl"><span class="corner-flourish-line-h"></span><span class="corner-flourish-line-v"></span></div>
  <div class="corner-flourish br"><span class="corner-flourish-line-h"></span><span class="corner-flourish-line-v"></span></div>
  <div class="property-header"><div class="property-label">Market Intelligence</div><h2 class="property-title">Area Sales Analysis</h2><div class="gold-rule"></div></div>
  <div class="analysis-chart">
    <div class="chart-bars">
      {% for comp in comparables[:4] %}
      <div class="chart-bar-wrap"><div class="chart-bar" style="height: {{ [40, (comp.sale_price / 8000) | int] | max }}px;"></div><div class="chart-bar-label">{{ comp.sold_date | default('-') }}</div></div>
      {% endfor %}
    </div>
  </div>
  <table class="analysis-table">
    <thead><tr><th>Metric</th><th>Subject</th><th>Low</th><th>Medium</th><th>High</th></tr></thead>
    <tbody>
      <tr><td>Distance</td><td>{{ stats.piq.distance | default('0') }}</td><td>{{ stats.low.distance | default('-') }}</td><td>{{ stats.medium.distance | default('-') }}</td><td>{{ stats.high.distance | default('-') }}</td></tr>
      <tr><td>Living Area</td><td>{{ stats.piq.sqft | default('-') }}</td><td>{{ stats.low.sqft | default('-') }}</td><td>{{ stats.medium.sqft | default('-') }}</td><td>{{ stats.high.sqft | default('-') }}</td></tr>
      <tr><td>Price/Sq.Ft.</td><td>{{ stats.piq.price_per_sqft | format_currency }}</td><td>{{ stats.low.price_per_sqft | format_currency }}</td><td>{{ stats.medium.price_per_sqft | format_currency }}</td><td>{{ stats.high.price_per_sqft | format_currency }}</td></tr>
      <tr><td>Year Built</td><td>{{ stats.piq.year_built | default('-') }}</td><td>{{ stats.low.year_built | default('-') }}</td><td>{{ stats.medium.year_built | default('-') }}</td><td>{{ stats.high.year_built | default('-') }}</td></tr>
      <tr><td>Lot Size</td><td>{{ stats.piq.lot_size | format_number }}</td><td>{{ stats.low.lot_size | format_number }}</td><td>{{ stats.medium.lot_size | format_number }}</td><td>{{ stats.high.lot_size | format_number }}</td></tr>
      <tr><td>Bedrooms</td><td>{{ stats.piq.bedrooms | default('-') }}</td><td>{{ stats.low.bedrooms | default('-') }}</td><td>{{ stats.medium.bedrooms | default('-') }}</td><td>{{ stats.high.bedrooms | default('-') }}</td></tr>
      <tr><td>Bathrooms</td><td>{{ stats.piq.bathrooms | default('-') }}</td><td>{{ stats.low.bathrooms | default('-') }}</td><td>{{ stats.medium.bathrooms | default('-') }}</td><td>{{ stats.high.bathrooms | default('-') }}</td></tr>
    </tbody>
    <tfoot><tr><td>Sale Price</td><td>{{ stats.piq.price | format_currency }}</td><td>{{ stats.low.price | format_currency }}</td><td>{{ stats.medium.price | format_currency }}</td><td>{{ stats.high.price | format_currency }}</td></tr></tfoot>
  </table>
  {{ macros.market_metrics_block(market_trends) }}
</div>
{{ macros.page_footer(agent, 5) }}
{% endblock %}

{# =============================================================================
   COMPARABLES PAGE OVERRIDE — Transplanted from V0 original (commit 8dbec7b)
   Rounded cards with burgundy price badge pill, pin SVG icon, cream stat grid
   ============================================================================= #}
{% block comparables %}
<div class="page-content elegant-v0-p6" style="padding: 0.6in;">
  <div class="corner-flourish tl"><span class="corner-flourish-line-h"></span><span class="corner-flourish-line-v"></span></div>
  <div class="corner-flourish br"><span class="corner-flourish-line-h"></span><span class="corner-flourish-line-v"></span></div>
  <div class="property-header"><div class="property-label">Recent Transactions</div><h2 class="property-title">Sales Comparables</h2><div class="gold-rule"></div></div>
  {{ macros.comp_confidence_bar(comp_confidence_grade, comp_confidence_reason, comparables|length) }}
  <div class="comp-grid">
    {% for comp in comparables[:4] %}
    <div class="comp-card">
      <div class="comp-card-image" {% if comp.map_image_url %}style="background-image: url('{{ comp.map_image_url }}'); background-size: cover; background-position: center;"{% endif %}>
        <div class="comp-card-badge">{{ comp.sale_price | format_currency }}</div>
      </div>
      <div class="comp-card-body">
        <div class="comp-card-address"><svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/></svg>{{ comp.address }}</div>
        <div class="comp-card-stats">
          <div class="comp-stat"><div class="comp-stat-label">{{ comp.sold_date_label | default('Sold') }}</div><div class="comp-stat-value">{{ comp.sold_date }}</div></div>
          <div class="comp-stat"><div class="comp-stat-label">Sq.Ft.</div><div class="comp-stat-value">{{ comp.sqft | format_number }}</div></div>
          <div class="comp-stat"><div class="comp-stat-label">Bed/Bath</div><div class="comp-stat-value">{{ comp.bedrooms }}/{{ comp.bathrooms }}</div></div>
          <div class="comp-stat"><div class="comp-stat-label">$/Sq.Ft.</div><div class="comp-stat-value">{{ comp.price_per_sqft | format_currency }}</div></div>
          {% if comp.lot_display %}<div class="comp-stat"><div class="comp-stat-label">Lot</div><div class="comp-stat-value">{{ comp.lot_display }}</div></div>{% endif %}
          <div class="comp-stat"><div class="comp-stat-label">HOA</div><div class="comp-stat-value">{% if comp.hoa_fee %}{{ comp.hoa_fee | format_currency }}{% if comp.hoa_frequency %}/{{ comp.hoa_frequency }}{% endif %}{% else %}No HOA{% endif %}</div></div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{{ macros.page_footer(agent, 6) }}
{% endblock %}

{# =============================================================================
   RANGE PAGE OVERRIDE — Transplanted from V0 original (commit 8dbec7b)
   Rounded aerial map, dark stat cards with large gold numbers, gradient slider
   ============================================================================= #}
{% block range %}
<div class="page-content elegant-v0-p7" style="padding: 0.6in;">
  <div class="corner-flourish tl"><span class="corner-flourish-line-h"></span><span class="corner-flourish-line-v"></span></div>
  <div class="corner-flourish br"><span class="corner-flourish-line-h"></span><span class="corner-flourish-line-v"></span></div>
  <div class="property-header"><div class="property-label">Valuation Summary</div><h2 class="property-title">Range of Sales</h2><div class="gold-rule"></div></div>
  <div class="range-map" {% if images.aerial_map %}style="background-image: url('{{ images.aerial_map }}'); background-size: cover; background-position: center;"{% endif %}>
    {% if images.aerial_map %}<img src="{{ images.aerial_map }}" alt="Aerial map" />{% endif %}
  </div>
  <div class="range-stats">
    <div class="range-stat"><div class="range-stat-num">{{ '%02d' | format(stats.total_comps | default(0)) }}</div><div class="range-stat-label">Total Comps</div></div>
    <div class="range-stat"><div class="range-stat-num">{{ stats.avg_sqft | default(0) | int }}</div><div class="range-stat-label">Avg. Sqft</div></div>
    <div class="range-stat"><div class="range-stat-num">{{ '%02d' | format(stats.avg_beds | default(0) | int) }}</div><div class="range-stat-label">Avg. Beds</div></div>
    <div class="range-stat"><div class="range-stat-num">{{ '%02d' | format(stats.avg_baths | default(0) | int) }}</div><div class="range-stat-label">Avg. Baths</div></div>
  </div>
  <div class="range-slider">
    <div class="range-slider-labels"><span>{{ stats.price_low | format_currency_short }}</span><span>{{ stats.price_high | format_currency_short }}</span></div>
    <div class="range-slider-track"><div class="range-slider-dot" style="left:5%;"></div><div class="range-slider-dot" style="left:95%;"></div></div>
  </div>
  <p class="range-note">The above statistics represent average property details for comparable homes sold within the last 12 months. The price range indicates the low and high sale prices for properties matching your home's characteristics including square footage, bedrooms, bathrooms, and lot size.</p>
</div>
{{ macros.page_footer(agent, 7) }}
{% endblock %}
