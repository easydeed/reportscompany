{# =============================================================================
   MODERN THEME
   Fresh, tech-forward, energetic contemporary aesthetic
   
   Typography: Space Grotesk (display) + DM Sans (body)
   Colors: Midnight blue + coral
   Style: Rounded corners, playful geometry, gradient accents
   ============================================================================= #}

{% extends '_base/base.jinja2' %}

{% block fonts %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
{% endblock %}

{% block theme_styles %}
<style>
  :root {
    /* Modern Theme Colors - Primary is customizable */
    --color-primary: {{ theme_color | default('#FF6B5B') }};
    --color-primary-light: #FF8A7D;
    --color-accent: #1A1F36;
    --color-accent-light: #2D3348;
    --color-background: #FFFFFF;
    --color-surface: #F1F5F9;
    --color-text: #1A1F36;
    --color-text-muted: #64748B;
    --color-border: #E2E8F0;
    
    /* Typography */
    --font-display: 'Space Grotesk', system-ui, sans-serif;
    --font-body: 'DM Sans', system-ui, sans-serif;
    
    /* Modern-specific - larger radius */
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 20px;
    --radius-xl: 28px;
    
    --shadow-sm: 0 2px 8px rgba(26, 31, 54, 0.06);
    --shadow-md: 0 8px 24px rgba(26, 31, 54, 0.1);
    --shadow-lg: 0 20px 50px rgba(26, 31, 54, 0.15);
  }
  
  /* Global border-radius override */
  .page {
    border-radius: var(--radius-lg);
  }
  
  /* ==========================================================================
     MODERN: Cover Page
     ========================================================================== */
  
  .page-cover {
    background: var(--color-accent);
    border-radius: var(--radius-lg);
  }
  
  .page-cover .cover-bg {
    position: absolute;
    inset: 0;
    background: 
      linear-gradient(135deg, 
        rgba(26, 31, 54, 0.7) 0%,
        rgba(26, 31, 54, 0.4) 50%,
        rgba(255, 107, 91, 0.1) 100%
      ){% if images.hero %},
      url('{{ images.hero }}') center/cover no-repeat{% endif %};
    border-radius: var(--radius-lg);
  }
  
  /* Top accent bar - gradient */
  .page-cover::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(90deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
    z-index: 10;
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  }
  
  /* Decorative circles */
  .page-cover .circle-1 {
    position: absolute;
    top: -40px;
    right: -40px;
    width: 160px;
    height: 160px;
    border-radius: 50%;
    background: var(--color-primary);
    opacity: 0.15;
    z-index: 1;
  }
  
  .page-cover .circle-2 {
    position: absolute;
    bottom: 180px;
    right: 60px;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    border: 3px solid var(--color-primary);
    opacity: 0.4;
    z-index: 1;
  }
  
  .page-cover .circle-3 {
    position: absolute;
    top: 200px;
    left: -20px;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: var(--color-primary);
    opacity: 0.08;
    z-index: 1;
  }
  
  /* Branding header */
  .page-cover .cover-branding-header {
    position: absolute;
    top: var(--page-margin);
    left: var(--page-margin);
    right: var(--page-margin);
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 5;
  }
  
  .page-cover .logo-pill {
    background: white;
    padding: 10px 16px;
    border-radius: var(--radius-xl);
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .page-cover .logo-pill img {
    max-height: 28px;
    max-width: 100px;
    object-fit: contain;
  }
  
  .page-cover .report-badge {
    background: var(--color-primary);
    color: white;
    padding: 10px 20px;
    border-radius: var(--radius-xl);
    font-family: var(--font-display);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
  }
  
  /* Main content area */
  .page-cover .cover-content {
    position: absolute;
    bottom: 160px;
    left: var(--page-margin);
    right: var(--page-margin);
    z-index: 5;
  }
  
  .page-cover .cover-property-type {
    display: inline-block;
    background: rgba(255, 107, 91, 0.2);
    color: var(--color-primary-light);
    padding: 6px 14px;
    border-radius: var(--radius-xl);
    font-family: var(--font-display);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 16px;
  }
  
  .page-cover .cover-address {
    font-family: var(--font-display);
    font-size: 48px;
    font-weight: 700;
    line-height: 1.1;
    color: white;
    margin-bottom: 12px;
  }
  
  .page-cover .cover-location {
    font-family: var(--font-body);
    font-size: 16px;
    font-weight: 500;
    color: rgba(255,255,255,0.75);
  }
  
  .page-cover .cover-accent-line {
    width: 60px;
    height: 4px;
    background: var(--color-primary);
    border-radius: var(--radius-full);
    margin: 24px 0;
  }
  
  .page-cover .property-stats {
    margin-top: 20px;
    gap: var(--space-lg);
  }
  
  .page-cover .stat-item {
    background: rgba(255,255,255,0.1);
    padding: 12px 16px;
    border-radius: var(--radius-md);
  }
  
  .page-cover .stat-value {
    color: white;
    font-size: 24px;
  }
  
  .page-cover .stat-label {
    color: rgba(255,255,255,0.6);
  }
  
  /* Footer override for cover */
  .page-cover .cover-footer {
    height: 130px;
    padding: 0 var(--page-margin);
    background: white;
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
  }
  
  .page-cover .cover-agent-photo {
    border: 3px solid var(--color-primary);
    width: 64px;
    height: 64px;
  }
  
  .page-cover .cover-agent-name {
    font-size: 18px;
    font-weight: 700;
  }
  
  /* ==========================================================================
     MODERN: Page Header Overrides
     ========================================================================== */
  
  .page-header {
    border-bottom: none;
    background: var(--color-surface);
    margin: calc(-1 * var(--page-margin));
    margin-bottom: var(--space-lg);
    padding: var(--space-lg) var(--page-margin);
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  }
  
  .page-title {
    font-size: 28px;
    font-weight: 700;
  }
  
  .page-header-accent {
    background: var(--color-primary);
    border-radius: var(--radius-full);
  }
  
  /* ==========================================================================
     MODERN: Contents Page
     ========================================================================== */
  
  .page-contents .contents-list {
    gap: var(--space-sm);
  }
  
  .page-contents .contents-item {
    border: none;
    background: var(--color-surface);
    padding: var(--space-md) var(--space-lg);
    border-radius: var(--radius-md);
    transition: background 0.2s;
  }
  
  .page-contents .contents-number {
    background: var(--color-primary);
    color: white;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-sm);
    font-size: 14px;
    font-weight: 700;
  }
  
  .page-contents .contents-title {
    font-size: 16px;
    font-weight: 600;
  }
  
  /* ==========================================================================
     MODERN: Data Tables
     ========================================================================== */
  
  .data-table {
    background: var(--color-surface);
    border-radius: var(--radius-md);
    overflow: hidden;
  }
  
  .data-table tr {
    border-bottom: 1px solid var(--color-border);
  }
  
  .data-table tr:last-child {
    border-bottom: none;
  }
  
  .data-table td {
    padding: 14px var(--space-md);
  }
  
  .table-title {
    background: var(--color-accent);
    color: white;
    padding: 14px var(--space-md);
    border-radius: var(--radius-md) var(--radius-md) 0 0;
    margin-bottom: 0;
    font-size: 13px;
  }
  
  /* ==========================================================================
     MODERN: Comp Cards
     ========================================================================== */
  
  .comp-card {
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
  }
  
  .comp-card-header {
    background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
    padding: 14px var(--space-md);
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  }
  
  .comp-number {
    background: rgba(255,255,255,0.2);
    padding: 4px 10px;
    border-radius: var(--radius-sm);
    font-size: 11px;
  }
  
  .comp-price {
    font-size: 18px;
    font-weight: 700;
  }
  
  .comp-image {
    height: 170px;
  }
  
  .comp-details {
    padding: var(--space-md);
  }
  
  .comp-stats {
    background: var(--color-surface);
    margin: var(--space-md) calc(-1 * var(--space-md)) calc(-1 * var(--space-md));
    padding: var(--space-sm) var(--space-md);
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
  }
  
  /* ==========================================================================
     MODERN: Analysis Summary
     ========================================================================== */
  
  .analysis-summary {
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
  }
  
  .analysis-range {
    background: var(--color-surface);
    margin: calc(-1 * var(--space-lg));
    margin-bottom: var(--space-lg);
    padding: var(--space-lg);
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  }
  
  .range-item {
    background: white;
    padding: var(--space-md);
    border-radius: var(--radius-md);
  }
  
  .range-median {
    background: var(--color-primary);
  }
  
  .range-median .range-label,
  .range-median .range-value {
    color: white;
  }
  
  .analysis-stat-value {
    color: var(--color-primary);
  }
  
  /* ==========================================================================
     MODERN: Map Card
     ========================================================================== */
  
  .map-card {
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
  }
  
  .map-card-header {
    background: var(--color-surface);
    font-size: 14px;
    font-weight: 600;
  }
  
  .map-card-image {
    height: 430px;
  }
  
  /* ==========================================================================
     MODERN: Price Range
     ========================================================================== */
  
  .price-range-track {
    height: 12px;
    background: linear-gradient(90deg, 
      var(--color-surface) 0%, 
      var(--color-primary) 30%,
      var(--color-primary-light) 70%,
      var(--color-surface) 100%
    );
    border-radius: var(--radius-full);
  }
  
  .price-range-marker-label {
    background: var(--color-accent);
    font-size: 13px;
    padding: 8px 14px;
    border-radius: var(--radius-md);
  }
  
  /* Range comps list */
  .range-comps-list {
    margin-top: var(--space-xl);
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }
  
  .range-comp-item {
    display: flex;
    justify-content: space-between;
    padding: var(--space-md) var(--space-lg);
    background: var(--color-surface);
    border-radius: var(--radius-md);
  }
  
  .range-comp-address {
    font-size: 14px;
    font-weight: 500;
  }
  
  .range-comp-price {
    font-size: 16px;
    font-weight: 700;
    color: var(--color-primary);
  }
  
  /* ==========================================================================
     MODERN: Footer Overrides
     ========================================================================== */
  
  .page-footer {
    border-top: none;
    background: var(--color-surface);
    margin: 0 calc(-1 * var(--page-margin));
    margin-bottom: calc(-1 * var(--footer-bottom));
    padding: var(--space-md) var(--page-margin);
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
  }
  
  .footer-agent-photo {
    border-color: var(--color-primary);
  }
  
  @media print {
    .page {
      border-radius: 0;
    }
    
    .page-cover,
    .page-cover .cover-bg,
    .page-cover::before,
    .page-cover .cover-footer,
    .page-header,
    .page-footer {
      border-radius: 0;
    }
  }
  
  /* V0 overrides — Modern */
  .range-bar-track {
    background: linear-gradient(90deg, var(--color-border) 0%, var(--color-primary) 100%);
    border-radius: 8px;
  }
  
  .range-comp-dot {
    background: var(--color-primary);
  }
  
  .range-comp-minibar-fill {
    background: var(--color-primary);
  }
  
  .range-bar-subject-label {
    color: var(--color-primary);
  }
  
  .range-bar-subject-arrow {
    border-top-color: var(--color-primary);
  }
  
  .contents-sidebar-accent {
    display: none;
  }

  /* ==========================================================================
     MODERN: Internal Page Accents — Theme personality on pages 2-7
     ========================================================================== */

  /* Top gradient accent bar on internal pages */
  .page-contents::before,
  .page-aerial::before,
  .page-property::before,
  .page-analysis::before,
  .page-comparables::before,
  .page-range::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
    z-index: 10;
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  }

  /* Key stats bar uses accent (dark) */
  .key-stats-bar {
    background: var(--color-accent);
    border-radius: var(--radius-lg);
  }

  /* Analysis summary with coral accent */
  .analysis-summary {
    border-top: 3px solid var(--color-primary);
  }

  /* Range bar container */
  .range-bar-container {
    border-radius: var(--radius-lg);
    border-top: 3px solid var(--color-primary);
  }

  /* Stats grid cards */
  .range-stat-card {
    border-radius: var(--radius-md);
    border-top: 2px solid var(--color-primary);
  }

  /* Market insight with coral accent */
  .market-insight {
    border-left: 3px solid var(--color-primary);
    border-radius: var(--radius-md);
  }

  /* Comp card hover accent */
  .comp-card {
    border-top: 2px solid var(--color-primary);
  }

  /* ==========================================================================
     MODERN V0 ORIGINAL: Analysis Page (p5) — Transplanted from commit 8dbec7b
     ========================================================================== */

  .modern-v0-p5 .pill { display: inline-block; padding: 6px 16px; border-radius: 100px; font-size: 11px; font-weight: 600; letter-spacing: 0.05em; }
  .modern-v0-p5 .pill-dark { background: var(--color-accent); color: white; }
  .modern-v0-p5 .pill { background: var(--color-surface); color: var(--color-text-muted); }

  .modern-v0-p5 .property-title {
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: 700;
    color: var(--color-accent);
  }

  .modern-v0-p5 .analysis-chart {
    background: white;
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 24px;
  }

  .modern-v0-p5 .chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
  }

  .modern-v0-p5 .chart-title {
    font-family: var(--font-display);
    font-size: 16px;
    font-weight: 600;
    color: var(--color-accent);
  }

  .modern-v0-p5 .chart-bars {
    display: flex;
    align-items: flex-end;
    justify-content: space-around;
    height: 160px;
    padding: 0 20px;
    border-bottom: 2px solid var(--color-surface);
  }

  .modern-v0-p5 .chart-bar-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
  }

  .modern-v0-p5 .chart-bar {
    width: 50px;
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
    border-radius: 8px 8px 0 0;
  }

  .modern-v0-p5 .chart-bar-label {
    font-size: 11px;
    color: var(--color-text-muted);
    font-weight: 500;
  }

  .modern-v0-p5 .analysis-table-wrap {
    background: white;
    border-radius: 20px;
    overflow: hidden;
  }

  .modern-v0-p5 .analysis-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
  }

  .modern-v0-p5 .analysis-table thead {
    background: var(--color-accent);
    color: white;
  }

  .modern-v0-p5 .analysis-table th {
    padding: 16px 14px;
    text-align: left;
    font-weight: 600;
    font-size: 12px;
    letter-spacing: 0.05em;
  }

  .modern-v0-p5 .analysis-table th:first-child { border-radius: 16px 0 0 0; }
  .modern-v0-p5 .analysis-table th:last-child { border-radius: 0 16px 0 0; }

  .modern-v0-p5 .analysis-table tbody tr {
    border-bottom: 1px solid var(--color-surface);
  }

  .modern-v0-p5 .analysis-table td {
    padding: 14px;
  }

  .modern-v0-p5 .analysis-table tfoot {
    background: var(--color-primary);
    color: white;
    font-weight: 600;
  }

  .modern-v0-p5 .analysis-table tfoot td {
    padding: 16px 14px;
  }

  /* ==========================================================================
     MODERN V0 ORIGINAL: Comparables Page (p6) — Transplanted from commit 8dbec7b
     ========================================================================== */

  .modern-v0-p6 .pill { display: inline-block; padding: 6px 16px; border-radius: 100px; font-size: 11px; font-weight: 600; background: var(--color-surface); color: var(--color-text-muted); }
  .modern-v0-p6 .property-title { font-family: var(--font-display); font-size: 28px; font-weight: 700; color: var(--color-accent); }

  .modern-v0-p6 .comp-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 24px;
  }

  .modern-v0-p6 .comp-card {
    background: var(--color-surface);
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(26,31,54,0.08);
  }

  .modern-v0-p6 .comp-card-image {
    height: 140px;
    background: linear-gradient(135deg, var(--color-text-muted), var(--color-accent));
    position: relative;
    overflow: hidden;
  }

  .modern-v0-p6 .comp-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .modern-v0-p6 .comp-card-price {
    position: absolute;
    bottom: 12px;
    left: 12px;
    background: var(--color-primary);
    color: white;
    padding: 8px 14px;
    border-radius: 10px;
    font-family: var(--font-display);
    font-size: 16px;
    font-weight: 700;
  }

  .modern-v0-p6 .comp-card-body {
    padding: 16px;
  }

  .modern-v0-p6 .comp-card-address {
    font-family: var(--font-display);
    font-size: 14px;
    font-weight: 600;
    color: var(--color-accent);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .modern-v0-p6 .comp-card-address svg {
    width: 14px;
    height: 14px;
    fill: var(--color-primary);
    flex-shrink: 0;
  }

  .modern-v0-p6 .comp-card-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
  }

  .modern-v0-p6 .comp-stat {
    background: white;
    border-radius: 10px;
    padding: 10px 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modern-v0-p6 .comp-stat-label {
    font-size: 11px;
    color: var(--color-text-muted);
  }

  .modern-v0-p6 .comp-stat-value {
    font-size: 13px;
    font-weight: 600;
    color: var(--color-accent);
  }

  /* ==========================================================================
     MODERN V0 ORIGINAL: Range Page (p7) — Transplanted from commit 8dbec7b
     ========================================================================== */

  .modern-v0-p7 .pill { display: inline-block; padding: 6px 16px; border-radius: 100px; font-size: 11px; font-weight: 600; background: var(--color-surface); color: var(--color-text-muted); }
  .modern-v0-p7 .property-title { font-family: var(--font-display); font-size: 28px; font-weight: 700; color: var(--color-accent); }

  .modern-v0-p7 .range-map {
    height: 4in;
    background: var(--color-surface);
    border-radius: 20px;
    overflow: hidden;
    margin: 24px 0;
    position: relative;
  }

  .modern-v0-p7 .range-map img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .modern-v0-p7 .range-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 30px;
  }

  .modern-v0-p7 .range-stat {
    background: var(--color-accent);
    border-radius: 16px;
    padding: 28px 16px;
    text-align: center;
  }

  .modern-v0-p7 .range-stat-num {
    font-family: var(--font-display);
    font-size: 42px;
    font-weight: 700;
    color: var(--color-primary);
    line-height: 1;
    margin-bottom: 10px;
  }

  .modern-v0-p7 .range-stat-label {
    font-size: 11px;
    font-weight: 600;
    color: rgba(255,255,255,0.7);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .modern-v0-p7 .range-slider {
    background: var(--color-surface);
    border-radius: 20px;
    padding: 30px;
  }

  .modern-v0-p7 .range-slider-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .modern-v0-p7 .range-slider-price {
    font-family: var(--font-display);
    font-size: 24px;
    font-weight: 700;
    color: var(--color-accent);
  }

  .modern-v0-p7 .range-slider-price.low {
    color: var(--color-primary);
  }

  .modern-v0-p7 .range-slider-track {
    height: 12px;
    background: linear-gradient(90deg, var(--color-primary) 0%, var(--color-primary-light) 50%, var(--color-surface) 100%);
    border-radius: 6px;
    position: relative;
    margin-bottom: 24px;
  }

  .modern-v0-p7 .range-slider-dot {
    width: 24px;
    height: 24px;
    background: white;
    border: 4px solid var(--color-primary);
    border-radius: 50%;
    position: absolute;
    top: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 0 4px 12px rgba(255,107,91,0.3);
  }

  .modern-v0-p7 .range-note {
    font-size: 13px;
    line-height: 1.7;
    color: var(--color-text-muted);
    text-align: center;
  }
</style>
{% endblock %}

{# =============================================================================
   COVER PAGE OVERRIDE
   ============================================================================= #}
{% block cover %}
<div class="cover-bg"></div>
<div class="circle-1"></div>
<div class="circle-2"></div>
<div class="circle-3"></div>

<div class="cover-branding-header">
  <div class="logo-pill">
    {% if agent.logo_url %}
    <img src="{{ agent.logo_url }}" alt="{{ agent.company_name }}">
    {% else %}
    <span style="font-family: var(--font-display); font-weight: 700; font-size: 14px; color: var(--color-accent);">{{ agent.company_name }}</span>
    {% endif %}
  </div>
  <div class="report-badge">Property Report</div>
</div>

<div class="cover-content">
  <div class="cover-property-type">{{ property.property_type | default('Single Family Residence') }}</div>
  <h1 class="cover-address">{{ property.street_address }}</h1>
  <p class="cover-location">{{ property.city }}, {{ property.state }} {{ property.zip_code }}</p>
  <div class="cover-accent-line"></div>
  {{ macros.property_stats(property) }}
</div>

{{ macros.cover_agent_block(agent) }}
{% endblock %}

{# =============================================================================
   ANALYSIS PAGE OVERRIDE — Transplanted from V0 original (commit 8dbec7b)
   Pill header + coral gradient chart + rounded table with midnight thead
   ============================================================================= #}
{% block analysis %}
<div class="page-content modern-v0-p5">
  <div class="analysis-header"><span class="pill pill-dark">Market Intelligence</span><h2 class="property-title" style="margin-top:12px;">Area Sales Analysis</h2></div>
  <div class="analysis-chart">
    <div class="chart-header"><div class="chart-title">Recent Sales Activity</div><span class="pill">Last 12 Months</span></div>
    <div class="chart-bars">
      {% for comp in comparables[:4] %}
      <div class="chart-bar-wrapper">
        <div class="chart-bar" style="height: {{ [40, (comp.sale_price / 5000) | int] | max }}px;"></div>
        <div class="chart-bar-label">{{ comp.sold_date | default('-') }}</div>
      </div>
      {% endfor %}
    </div>
  </div>
  <div class="analysis-table-wrap">
    <table class="analysis-table">
      <thead><tr><th>Metric</th><th>Subject</th><th>Low</th><th>Medium</th><th>High</th></tr></thead>
      <tbody>
        <tr><td>Distance</td><td>{{ stats.piq.distance | default('0') }}</td><td>{{ stats.low.distance | default('-') }}</td><td>{{ stats.medium.distance | default('-') }}</td><td>{{ stats.high.distance | default('-') }}</td></tr>
        <tr><td>Living Area</td><td>{{ stats.piq.sqft | default('-') }}</td><td>{{ stats.low.sqft | default('-') }}</td><td>{{ stats.medium.sqft | default('-') }}</td><td>{{ stats.high.sqft | default('-') }}</td></tr>
        <tr><td>Price/Sq.Ft.</td><td>{{ stats.piq.price_per_sqft | format_currency }}</td><td>{{ stats.low.price_per_sqft | format_currency }}</td><td>{{ stats.medium.price_per_sqft | format_currency }}</td><td>{{ stats.high.price_per_sqft | format_currency }}</td></tr>
        <tr><td>Year Built</td><td>{{ stats.piq.year_built | default('-') }}</td><td>{{ stats.low.year_built | default('-') }}</td><td>{{ stats.medium.year_built | default('-') }}</td><td>{{ stats.high.year_built | default('-') }}</td></tr>
        <tr><td>Bedrooms</td><td>{{ stats.piq.bedrooms | default('-') }}</td><td>{{ stats.low.bedrooms | default('-') }}</td><td>{{ stats.medium.bedrooms | default('-') }}</td><td>{{ stats.high.bedrooms | default('-') }}</td></tr>
      </tbody>
      <tfoot><tr><td>Sale Price</td><td>{{ stats.piq.price | format_currency }}</td><td>{{ stats.low.price | format_currency }}</td><td>{{ stats.medium.price | format_currency }}</td><td>{{ stats.high.price | format_currency }}</td></tr></tfoot>
    </table>
  </div>
</div>
{{ macros.page_footer(agent, 5) }}
{% endblock %}

{# =============================================================================
   COMPARABLES PAGE OVERRIDE — Transplanted from V0 original (commit 8dbec7b)
   2x2 rounded comp cards, coral price badge bottom-left, pin SVG, flex stats
   ============================================================================= #}
{% block comparables %}
<div class="page-content modern-v0-p6">
  <div class="property-header"><div><span class="pill">Recent Transactions</span><h2 class="property-title" style="margin-top:12px;">Sales Comparables</h2></div></div>
  <div class="comp-grid">
    {% for comp in comparables[:4] %}
    <div class="comp-card">
      <div class="comp-card-image" {% if comp.photo_url or comp.map_image_url %}style="background-image: url('{{ comp.photo_url | default(comp.map_image_url) }}'); background-size: cover; background-position: center;"{% endif %}>
        <div class="comp-card-price">{{ comp.sale_price | format_currency }}</div>
      </div>
      <div class="comp-card-body">
        <div class="comp-card-address"><svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/></svg>{{ comp.address }}</div>
        <div class="comp-card-stats">
          <div class="comp-stat"><span class="comp-stat-label">Sold</span><span class="comp-stat-value">{{ comp.sold_date }}</span></div>
          <div class="comp-stat"><span class="comp-stat-label">Sq.Ft.</span><span class="comp-stat-value">{{ comp.sqft | format_number }}</span></div>
          <div class="comp-stat"><span class="comp-stat-label">Bed/Bath</span><span class="comp-stat-value">{{ comp.bedrooms }}/{{ comp.bathrooms }}</span></div>
          <div class="comp-stat"><span class="comp-stat-label">$/Sq.Ft.</span><span class="comp-stat-value">{{ comp.price_per_sqft | format_currency }}</span></div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{{ macros.page_footer(agent, 6) }}
{% endblock %}

{# =============================================================================
   RANGE PAGE OVERRIDE — Transplanted from V0 original (commit 8dbec7b)
   Rounded map, dark stat cards, coral gradient slider, dot markers
   ============================================================================= #}
{% block range %}
<div class="page-content modern-v0-p7">
  <div class="property-header"><div><span class="pill">Valuation Summary</span><h2 class="property-title" style="margin-top:12px;">Range of Sales</h2></div></div>
  <div class="range-map" {% if images.aerial_map %}style="background-image: url('{{ images.aerial_map }}'); background-size: cover; background-position: center;"{% endif %}>
    {% if images.aerial_map %}<img src="{{ images.aerial_map }}" alt="Aerial map">{% endif %}
  </div>
  <div class="range-stats">
    <div class="range-stat"><div class="range-stat-num">{{ '%02d' | format(stats.total_comps | default(0)) }}</div><div class="range-stat-label">Total Comps</div></div>
    <div class="range-stat"><div class="range-stat-num">{{ stats.avg_sqft | default(0) | int }}</div><div class="range-stat-label">Avg. Sq.Ft.</div></div>
    <div class="range-stat"><div class="range-stat-num">{{ '%02d' | format(stats.avg_beds | default(0) | int) }}</div><div class="range-stat-label">Avg. Beds</div></div>
    <div class="range-stat"><div class="range-stat-num">{{ '%02d' | format(stats.avg_baths | default(0) | int) }}</div><div class="range-stat-label">Avg. Baths</div></div>
  </div>
  <div class="range-slider">
    <div class="range-slider-header">
      <div class="range-slider-price low">{{ stats.price_low | format_currency_short }}</div>
      <div class="range-slider-price">{{ stats.price_high | format_currency_short }}</div>
    </div>
    <div class="range-slider-track">
      <div class="range-slider-dot" style="left:5%;"></div>
      <div class="range-slider-dot" style="left:95%;"></div>
    </div>
    <p class="range-note">The above statistics represent average property details for comparable homes sold within the last 12 months. The price range indicates the low and high sale prices for properties matching your home's characteristics.</p>
  </div>
</div>
{{ macros.page_footer(agent, 7) }}
{% endblock %}
